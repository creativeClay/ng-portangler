<div class="bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-6 space-y-6 h-auto">
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-3">
      <span class="inline-flex h-10 w-10 items-center justify-center rounded-lg bg-indigo-50 text-indigo-600">
        <i class="fa-solid fa-location-dot"></i>
      </span>
      <div>
        <h2 class="text-lg font-semibold text-gray-900">{{ mode === 'edit' ? 'Edit Location' : 'Create Location' }}</h2>
        <p class="text-sm text-gray-500">{{ mode === 'edit' ? 'Update location details, facility and images' : 'Add a new location' }}</p>
      </div>
    </div>
    <button class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-200 text-gray-800 hover:bg-gray-50" (click)="cancel()">
      <i class="fa-solid fa-xmark"></i>
      <span>Cancel</span>
    </button>
  </div>

  <!-- Stepper -->
  <div class="flex items-center gap-3">
    <div class="flex items-center gap-2">
      <span class="inline-flex h-8 w-8 items-center justify-center rounded-full text-xs font-semibold"
            [ngClass]="stepIndex === 0 ? 'bg-pont-green text-white' : 'bg-gray-100 text-gray-700'">1</span>
      <span class="text-xs font-medium" [ngClass]="stepIndex === 0 ? 'text-gray-900' : 'text-gray-600'">Details</span>
    </div>
    <span class="flex-1 h-px bg-gray-200"></span>
    <div class="flex items-center gap-2">
      <span class="inline-flex h-8 w-8 items-center justify-center rounded-full text-xs font-semibold"
            [ngClass]="stepIndex === 1 ? 'bg-pont-green text-white' : 'bg-gray-100 text-gray-700'">2</span>
      <span class="text-xs font-medium" [ngClass]="stepIndex === 1 ? 'text-gray-900' : 'text-gray-600'">Facility</span>
    </div>
    <span class="flex-1 h-px bg-gray-200"></span>
    <div class="flex items-center gap-2">
      <span class="inline-flex h-8 w-8 items-center justify-center rounded-full text-xs font-semibold"
            [ngClass]="stepIndex === 2 ? 'bg-pont-green text-white' : 'bg-gray-100 text-gray-700'">3</span>
      <span class="text-xs font-medium" [ngClass]="stepIndex === 2 ? 'text-gray-900' : 'text-gray-600'">Images</span>
    </div>
  </div>

  <!-- Step 1: Details -->
  <div *ngIf="stepIndex === 0" class="space-y-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Name *</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.name" placeholder="Location name" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Capacity *</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.capacity" placeholder="e.g. 200" />
      </div>
      <div class="md:col-span-2">
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Description (max 200)</label>
        <textarea class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" rows="3" [(ngModel)]="details.description" maxlength="200" placeholder="Short description"></textarea>
        <div class="text-right text-xs text-gray-500">{{ details.description.length || 0 }}/200</div>
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Address *</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.address" placeholder="Street address" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">City *</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.city" placeholder="City" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Proviance</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.proviance" placeholder="Province/State" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Country *</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.country" placeholder="Country" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Latitude</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.lat" placeholder="Latitude" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Longitude</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.long" placeholder="Longitude" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">ZIP</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.zip" placeholder="ZIP/Postal Code" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Phone</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.phone" placeholder="Phone" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Email</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.email" placeholder="Email" />
      </div>
      <div>
        <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Website</label>
        <input class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="details.website" placeholder="Website" />
      </div>
    </div>

    <div class="flex items-center justify-between pt-2">
      <div></div>
      <button (click)="detailSubmit()" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-pont-green text-white hover:bg-pont-green/90">{{ mode === 'edit' ? 'Save & Continue' : 'Next' }}</button>
    </div>
  </div>

  <!-- Step 2: Facility -->
  <div *ngIf="stepIndex === 1" class="space-y-6">
    <!-- Section 1: Amenities -->
    <div>
      <div class="flex items-end gap-4">
        <div class="flex-1">
          <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Amenity *</label>
          <select class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="facility.amenityId">
            <option value="0">Select Amenity</option>
            <option *ngFor="let a of amenities" [value]="a.id">{{ a.name }}</option>
          </select>
        </div>
        <div>
          <button class="text-xs bg-pont-green text-white px-4 py-3 rounded-lg mt-1.5" (click)="addAmenity()">Add</button>
        </div>
      </div>
      <div class="mt-2 flex flex-wrap gap-2" *ngIf="selectedAmenities.length > 0">
        <span *ngFor="let a of selectedAmenities" class="inline-flex items-center gap-2 text-xs px-2.5 py-1 rounded-full bg-indigo-50 text-indigo-700">
          {{ a.name }}
          <button class="text-indigo-700/80" (click)="removeAmenity(a.id)"><i class="fa-solid fa-xmark"></i></button>
        </span>
      </div>
    </div>
    <div class="h-px bg-gray-200"></div>

    <!-- Section 2: Specifications -->
    <div>
      <div class="flex items-end gap-4">
        <div class="flex-1">
          <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Specifications *</label>
          <select class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="facility.specificationId">
            <option value="0">Select Specification</option>
            <option *ngFor="let s of specifications" [value]="s.id">{{ s.name | titlecase }}</option>
          </select>
        </div>
        <div>
          <button class="text-xs bg-pont-green text-white px-4 py-3 rounded-lg mt-1.5" (click)="addSpecification()">Add</button>
        </div>
      </div>
      <div class="mt-2 flex flex-wrap gap-2" *ngIf="selectedSpecifications.length > 0">
        <span *ngFor="let s of selectedSpecifications" class="inline-flex items-center gap-2 text-xs px-2.5 py-1 rounded-full bg-emerald-50 text-emerald-700">
          {{ s.name }}
          <button class="text-emerald-700/80" (click)="removeSpecification(s.id)"><i class="fa-solid fa-xmark"></i></button>
        </span>
      </div>
    </div>
    <div class="h-px bg-gray-200"></div>

    <!-- Section 3: Types -->
    <div>
      <div class="flex items-end gap-4">
        <div class="flex-1">
          <label class="text-xs font-medium text-gray-600 uppercase tracking-wide">Type *</label>
          <select class="w-full mt-1 px-3 py-2.5 rounded-lg border border-gray-200" [(ngModel)]="facility.typeId">
            <option value="0">Select Type</option>
            <option *ngFor="let t of locationTypes" [value]="t.id">{{ t.name | titlecase}}</option>
          </select>
        </div>
        <div>
          <button class="text-xs bg-pont-green text-white px-4 py-3 rounded-lg mt-1.5" (click)="addType()">Add</button>
        </div>
      </div>
      <div class="mt-2 flex flex-wrap gap-2" *ngIf="selectedTypes.length > 0">
        <span *ngFor="let t of selectedTypes" class="inline-flex items-center gap-2 text-xs px-2.5 py-1 rounded-full bg-amber-50 text-amber-700">
          {{ t.name }}
          <button class="text-amber-700/80" (click)="removeType(t.id)"><i class="fa-solid fa-xmark"></i></button>
        </span>
      </div>
    </div>

    <div class="flex items-center justify-between pt-2">
      <button (click)="back()" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-200 hover:bg-gray-50">Back</button>
      <button (click)="nextImage()" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-pont-rust text-white hover:bg-pont-rust/90">Next</button>
    </div>
  </div>

  <!-- Step 3: Images -->
  <div *ngIf="stepIndex === 2" class="space-y-4">
    <div class="w-full">
      <label
        for="fileInput"
        class="block text-sm font-semibold text-gray-700 tracking-wide mb-2"
      >
        Upload Images
      </label>
    
      <div
        class="flex flex-col items-center justify-center w-full p-6 border-2 border-dashed rounded-2xl cursor-pointer transition"
        [ngClass]="isDragging ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-blue-500'"
        (click)="openFilePicker()"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
      >
        <svg
          class="w-10 h-10 text-gray-400 mb-2"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16V4m0 0l-4 4m4-4l4 4M17 8v12m0 0l-4-4m4 4l4-4"
          />
        </svg>
        <p class="text-sm text-gray-500">Click or drag images here to upload</p>
        <input
          #fileInput
          id="fileInput"
          type="file"
          multiple
          accept="image/*"
          class="hidden"
          (change)="onFilesSelected($event)"
        />
      </div>
    </div>
    
    <div *ngIf="isLoadingImages" class="text-sm text-gray-500">Loading images...</div>
    <div *ngIf="existingImages.length > 0" class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div *ngFor="let img of existingImages" class="relative">
        <img [src]="img.url" class="w-full h-32 object-cover rounded-lg border" />
        <button class="absolute top-2 right-2 bg-black/60 text-white rounded-full p-1 text-xs" (click)="deleteExistingImage(img.id)">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div *ngIf="imagePreviews.length > 0" class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div *ngFor="let img of imagePreviews; let i = index" class="relative">
        <img [src]="img" class="w-full h-32 object-cover rounded-lg border" />
        <button class="absolute top-2 right-2 bg-black/60 text-white rounded-full p-1 text-xs" (click)="removeImage(i)">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="flex items-center justify-between pt-2">
      <button (click)="back()" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-200 hover:bg-gray-50">Back</button>
      <div class="flex flex-row space-x-2">
      <button [disabled]="uploading" (click)="submit()" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-black text-white hover:bg-gray-800">
        <span *ngIf="!uploading">Upload Images</span>
        <span *ngIf="uploading" class="inline-flex items-center gap-2">
          <svg width="18" height="18" viewBox="0 0 24 24" class="animate-spin"><path fill="currentColor" d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"/><path fill="currentColor" d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z"/></svg>
          <span>Saving...</span>
        </span>
      </button>
       <button (click)="done()" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-pont-green text-white hover: bg-pont-green/90">Done</button>
      </div>
    </div>
  </div>
</div>


